#!/bin/bash

# DIO Platform - Final Setup and Test Script

echo "üéØ DIO Platform - Final Setup Script"
echo "=================================="
echo ""

echo "‚úÖ All Docker files have been created and fixed!"
echo ""

echo "üîß Issues Fixed:"
echo "   ‚Ä¢ Removed obsolete 'version' from docker-compose.yml"
echo "   ‚Ä¢ Fixed Dockerfile.frontend to use 'npm install'"
echo "   ‚Ä¢ Fixed .dockerignore files (was too aggressive)"
echo "   ‚Ä¢ Updated all scripts to use 'docker compose'"
echo ""

echo "üìÅ Files Ready:"
echo "   ‚Ä¢ docker-compose.yml (main orchestration)"
echo "   ‚Ä¢ Dockerfile.frontend (Next.js app)"
echo "   ‚Ä¢ Dockerfile (Python services)"
echo "   ‚Ä¢ requirements.txt (Python dependencies)"
echo "   ‚Ä¢ .dockerignore (proper build contexts)"
echo ""

echo "üöÄ To Start DIO Platform:"
echo ""
echo "Step 1: Clean up any existing containers"
echo "   docker compose down -v --remove-orphans"
echo ""
echo "Step 2: Clean Docker cache"
echo "   docker system prune -f"
echo ""
echo "Step 3: Start development environment"
echo "   docker compose --profile mock up -d --build"
echo ""
echo "Step 4: Initialize database"
echo "   npm run db:push"
echo ""
echo "Step 5: Wait 30 seconds for services to start"
echo "   sleep 30"
echo ""
echo "Step 6: Check status"
echo "   docker compose ps"
echo ""
echo "Step 7: Check services"
echo "   curl http://localhost:8000/health"
echo "   curl http://localhost:3000"
echo ""

echo "üéØ To Test Attack Simulator:"
echo ""
echo "Step 1: Build attack simulator"
echo "   cd components/attack-simulator"
echo "   docker build -t dio-attack-simulator ."
echo "   cd ../.."
echo ""
echo "Step 2: Launch attack"
echo "   docker run --rm --network dio-platform_dio-network dio-attack-simulator python main.py cpu"
echo ""

echo "üìä Access Points:"
echo "   ‚Ä¢ Frontend Dashboard: http://localhost:3000"
echo "   ‚Ä¢ Nerve Center API: http://localhost:8000"
echo "   ‚Ä¢ API Documentation: http://localhost:8000/docs"
echo "   ‚Ä¢ Mesh Network: ws://localhost:4222"
echo ""

echo "üîç Troubleshooting:"
echo ""
echo "If build fails:"
echo "   1. Check Docker is running: docker info"
echo "   2. Check available disk space: df -h"
echo "   3. Check network connectivity"
echo "   4. Try: docker compose build --no-cache"
echo ""

echo "If services don't start:"
echo "   1. Check logs: docker compose logs [service-name]"
echo "   2. Check ports: netstat -tulpn | grep :3000"
echo "   3. Check network: docker network ls"
echo "   4. Restart: docker compose restart"
echo ""

echo "If dashboard not working:"
echo "   1. Check frontend logs: docker compose logs frontend"
echo "   2. Check browser console (F12)"
echo "   3. Clear browser cache"
echo "   4. Try different browser"
echo ""

echo "üìö Documentation:"
echo "   ‚Ä¢ README.md - Project overview"
echo "   ‚Ä¢ DEPLOYMENT.md - Detailed deployment guide"
echo "   ‚Ä¢ PHASE1_USE_CASES.md - 5 POC use cases"
echo "   ‚Ä¢ ATTACK_SIMULATOR.md - Attack testing guide"
echo "   ‚Ä¢ TROUBLESHOOTING.md - Troubleshooting guide"
echo "   ‚Ä¢ QUICK_FIX.md - Quick fix guide"
echo ""

echo "üéÆ Attack Simulator Commands:"
echo "   ‚Ä¢ CPU Attack: docker run --rm --network dio-platform_dio-network dio-attack-simulator python main.py cpu"
echo "   ‚Ä¢ Memory Attack: docker run --rm --network dio-platform_dio-network dio-attack-simulator python main.py memory"
echo "   ‚Ä¢ Network Attack: docker run --rm --network dio-platform_dio-network dio-attack-simulator python main.py network"
echo "   ‚Ä¢ Process Attack: docker run --rm --network dio-platform_dio-network dio-attack-simulator python main.py process"
echo "   ‚Ä¢ File Attack: docker run --rm --network dio-platform_dio-network dio-attack-simulator python main.py file"
echo "   ‚Ä¢ Multi-Vector: docker run --rm --network dio-platform_dio-network dio-attack-simulator python main.py multi"
echo "   ‚Ä¢ Lateral: docker run --rm --network dio-platform_dio-network dio-attack-simulator python main.py lateral"
echo "   ‚Ä¢ Interactive: docker run --rm -it --network dio-platform_dio-network dio-attack-simulator python main.py interactive"
echo ""

echo "‚úÖ All components are now properly configured!"
echo "üéâ Your DIO Platform is ready for Phase 1 POC!"
echo ""

echo "üöÄ Quick Start Commands:"
echo ""
echo "# Start everything"
echo "docker compose --profile mock up -d --build && npm run db:push"
echo ""
echo "# Check status"
echo "docker compose ps"
echo ""
echo "# View logs"
echo "docker compose logs -f"
echo ""
echo "# Stop everything"
echo "docker compose down"
echo ""

echo "üìû For support, check the documentation files or provide:"
echo "   ‚Ä¢ Operating system and version"
echo "   ‚Ä¢ Docker version: docker --version"
echo "   ‚Ä¢ Full error messages"
echo "   ‚Ä¢ Output of: docker compose logs"